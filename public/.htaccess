# Enable Gzip Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Optimized Browser Caching for Performance
<IfModule mod_expires.c>
    ExpiresActive on
    
    # Aggressive caching for versioned assets
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType application/json "access plus 1 hour"
    
    # Image optimization with long cache
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/ico "access plus 1 year"
    
    # Font caching
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/ttf "access plus 1 year"
    
    # Document caching
    ExpiresByType text/html "access plus 1 hour"
    ExpiresByType application/pdf "access plus 1 month"
</IfModule>

# Enhanced Compression for Better Performance
<IfModule mod_brotli.c>
    AddOutputFilterByType BROTLI_COMPRESS text/plain
    AddOutputFilterByType BROTLI_COMPRESS text/html
    AddOutputFilterByType BROTLI_COMPRESS text/css
    AddOutputFilterByType BROTLI_COMPRESS application/javascript
    AddOutputFilterByType BROTLI_COMPRESS application/json
    AddOutputFilterByType BROTLI_COMPRESS text/xml
    AddOutputFilterByType BROTLI_COMPRESS application/xml
</IfModule>

# Comprehensive Security Headers
<IfModule mod_headers.c>
    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options nosniff
    
    # Prevent clickjacking
    Header always set X-Frame-Options DENY
    
    # XSS Protection (legacy browsers)
    Header always set X-XSS-Protection "1; mode=block"
    
    # Referrer Policy - control referrer information
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Permissions Policy - control browser features
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=(), ambient-light-sensor=(), autoplay=(), encrypted-media=(), fullscreen=(self), picture-in-picture=()"
    
    # Enhanced Content Security Policy
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'sha256-xyz' https://fonts.googleapis.com https://cdn.gpteng.co; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: https: blob:; connect-src 'self' https: wss:; media-src 'self' data:; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none'; upgrade-insecure-requests; block-all-mixed-content;"
    
    # Strict Transport Security - enforce HTTPS
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    
    # Cross Origin Embedder Policy
    Header always set Cross-Origin-Embedder-Policy "credentialless"
    
    # Cross Origin Opener Policy
    Header always set Cross-Origin-Opener-Policy "same-origin"
    
    # Cross Origin Resource Policy
    Header always set Cross-Origin-Resource-Policy "same-origin"
    
    # Expect-CT Header for certificate transparency
    Header always set Expect-CT "max-age=86400, enforce"
    
    # Remove server information disclosure
    Header always unset Server
    Header always unset X-Powered-By
    
    # Security for sensitive files
    <FilesMatch "\.(json|xml|log|conf|config|bak|backup|old|tmp|temp)$">
        Header always set X-Robots-Tag "noindex, nofollow"
    </FilesMatch>
</IfModule>

# Redirect to HTTPS
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# SEO Redirects
RedirectMatch 301 ^/dhirendra$ /
RedirectMatch 301 ^/dhirendra-singh-dhami$ /